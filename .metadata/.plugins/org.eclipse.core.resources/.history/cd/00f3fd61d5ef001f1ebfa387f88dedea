package proativa.projeto.modelo;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import javafx.event.ActionEvent;
import javafx.stage.FileChooser;
import javafx.stage.Stage;

public class Arquivo {

	private String nomeArquivo;
	File arquivoSelecionado;
	
	List<Pessoa> pessoas = new ArrayList<>();

	public Arquivo() {

	}

	public Arquivo(ActionEvent event) throws Exception {
		buscarArquivo(event);
	}

	public void buscarArquivo(ActionEvent event) {

		try {
			FileChooser selecionarArquivo = new FileChooser();
			selecionarArquivo.setTitle("Selecionar Arquivo Excel");
			selecionarArquivo.getExtensionFilters()
					.addAll(new FileChooser.ExtensionFilter("Arquivos Excel", "*.xls", "*.xlsx"));
			Stage stage = (Stage) ((javafx.scene.Node) event.getSource()).getScene().getWindow();
			arquivoSelecionado = selecionarArquivo.showOpenDialog(stage);
			nomeArquivo = arquivoSelecionado.getName();

		} catch (Exception e) {
			System.out.println(e.getMessage());
		}
		
	}

	public void lerArquivo() {
		boolean filtroCpfEmail;
		String nomeCelula;
		int contador = 0;
		
		try(FileInputStream arquivo = new FileInputStream(arquivoSelecionado)){
			Workbook workbook ;
			if(nomeArquivo.endsWith(".xlsx")) {
				workbook =  new XSSFWorkbook(arquivo);
			} else {
				workbook =  new HSSFWorkbook(arquivo);
			}
				
			 Sheet sheet = workbook.getSheetAt(0);
			 
			 int rowIndex = 0;
			 
			 for(Row linha: sheet) {
				 
				 // Pula a primeira linha da planilha
				 
				 if (rowIndex == 0) {
					 rowIndex++;
					 continue;
				 }
				 
				 for (Cell celula : linha) {
					 
					 
					 if(filtroCpfEmail) {
					 switch (celula.getCellType()) {
					 
					 case STRING:
//							 System.out.println(celula.getStringCellValue());
							 System.out.println(linha.getCell(3) + " | " + linha.getCell(4));
							 Pessoa pessoa = new Pessoa();
							 pessoas.add(null)
							 
							 contador++;
						 break;
					 
					 case NUMERIC:
						 System.out.print(celula.getNumericCellValue() + " | \t");
						 break;
					 
					 case BOOLEAN:
						 System.out.print(celula.getBooleanCellValue() + " | \t");
						 break;
					
					 case FORMULA:
						 System.out.print(celula.getCellFormula() + " | \t");
						 break;
						 
					default:
//						System.out.print("Desconhecido \t");
						
					 }
				 }
//				 System.out.println();
					 rowIndex++;
				 }
			 }
			 System.out.println("Quatidade de CPFs:  " + contador);
			 workbook.close();
			
		}catch (IOException e) {
			e.printStackTrace();
		}
		
	}
	
	

	public String getNome() {
		if (nomeArquivo != null) {
			return nomeArquivo;
		} else {
			return "Arquivo n√£o selecionado!";
		}
	}
}
